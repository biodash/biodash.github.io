<!DOCTYPE html><html lang="en-us" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.0.0-beta.3 for Hugo" />
  

  

  
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Jelmer Poelstra" />

  
  
  
    
  
  <meta name="description" content="This will be the first of several sessions broadly about iterating in order to avoid copying-and-pasting of code, and today we will talk about vectorization and for loops." />

  
  <link rel="alternate" hreflang="en-us" href="https://biodash.github.io/codeclub/12_loops/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#3f51b5" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.80f9a276c6100914c616a06e45ba8d09.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-9F9CQ7P0DX"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'G-9F9CQ7P0DX', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hucc2cf774636a7e386557c89fa75ff618_191491_32x32_fill_lanczos_center_2.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hucc2cf774636a7e386557c89fa75ff618_191491_180x180_fill_lanczos_center_2.png" />

  <link rel="canonical" href="https://biodash.github.io/codeclub/12_loops/" />

  
  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image" />
  
  <meta property="og:site_name" content="BioDASH" />
  <meta property="og:url" content="https://biodash.github.io/codeclub/12_loops/" />
  <meta property="og:title" content="Session 12: Vectorization and loops in R | BioDASH" />
  <meta property="og:description" content="This will be the first of several sessions broadly about iterating in order to avoid copying-and-pasting of code, and today we will talk about vectorization and for loops." /><meta property="og:image" content="https://biodash.github.io/codeclub/12_loops/featured.jpeg" />
    <meta property="twitter:image" content="https://biodash.github.io/codeclub/12_loops/featured.jpeg" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2021-03-01T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-08-18T11:47:57-04:00">
  

  



  

  

  <link rel='stylesheet' href='/css/highlight-light.css' title='hl-light'>
<link rel='stylesheet' href='/css/highlight-dark.css' title='hl-dark' disabled>



  <title>Session 12: Vectorization and loops in R | BioDASH</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="0d1188d36cd786cdd66d047b20214d54" >

  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.7a224883d792570fd34d30c7134eace3.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    











  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu6407506e646a281542ecb299640680ce_37988_0x70_resize_lanczos_2.png" alt="BioDASH"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu6407506e646a281542ecb299640680ce_37988_0x70_resize_lanczos_2.png" alt="BioDASH"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Code Club</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/codeclub-schedule/"><span>- <b>Schedule</b></span></a>
            
              <a class="dropdown-item" href="/codeclub-schedule/#previous-semesters"><span>- Past Sessions</span></a>
            
              <a class="dropdown-item" href="/codeclub-setup/"><span>- Computer Setup</span></a>
            
              <a class="dropdown-item" href="/"><span>------------------------</span></a>
            
              <a class="dropdown-item" href="/codeclub-suggest/"><span>- Suggest a Topic</span></a>
            
              <a class="dropdown-item" href="/codeclub-present/"><span>- Info for Presenters</span></a>
            
              <a class="dropdown-item" href="/"><span>-----------------------</span></a>
            
              <a class="dropdown-item" href="/codeclub-about/"><span>- <b>About Code Club & Join Us!</b></span></a>
            
          </div>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Tutorials & Resources</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/events/"><span>Events</span></a>
            
              <a class="dropdown-item" href="/"><span>---------------------</span></a>
            
              <a class="dropdown-item" href="/tutorials/r-resources-tips/"><span>- R Resources and Tips</span></a>
            
              <a class="dropdown-item" href="/"><span>--------------------</span></a>
            
              <a class="dropdown-item" href="https://mcic-osu.github.io/2020-12-microbiomics-workshop/"><span>- Metabarcoding workshop (Fall '20)</span></a>
            
              <a class="dropdown-item" href="/tutorials/2021-01_rnaseq/"><span>- RNA-seq intro meetings (Spring '21)</span></a>
            
              <a class="dropdown-item" href="https://mcic-osu.github.io/pracs-sp21/"><span>- Computing Course (Spring '21)</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/support/"><span>Bioinformatics Support</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/about/"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://github.com/biodash/biodash.github.io" target="_blank" rel="noopener"><i class='fab fa-github'></i><span></span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/index.xml" target="_blank" rel="noopener"><i class='fas fa-rss'></i><span></span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      
        
      
        
      
        
      

      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    
<div class="container-fluid docs">
    <div class="row flex-xl-nowrap">
        <div class="d-none d-xl-block col-xl-2 docs-toc">
            <ul class="nav toc-top">
                <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
            </ul>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#setup">Setup</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#dont-repeat-yourself">Don&rsquo;t Repeat Yourself</a></li>
        <li><a href="#iteration">Iteration</a></li>
      </ul>
    </li>
    <li><a href="#i-vectorization">I: Vectorization</a>
      <ul>
        <li><a href="#other-vectorization-patterns">Other vectorization patterns</a></li>
        <li><a href="#vectorization-with-matrices">Vectorization with matrices</a></li>
        <li><a href="#vectorization-with-indices">Vectorization with indices</a></li>
      </ul>
    </li>
    <li><a href="#ii-for-loops">II: For loops</a>
      <ul>
        <li><a href="#for-loop-output"><code>for</code> loop output</a></li>
        <li><a href="#summary-guidelines-when-speed-is-an-issue">Summary guidelines (when speed is an issue)</a></li>
      </ul>
    </li>
    <li><a href="#breakout-rooms">Breakout rooms!</a>
      <ul>
        <li><a href="#exercise-1-vectorization">Exercise 1: Vectorization</a></li>
        <li><a href="#exercise-2-for-loops">Exercise 2: for loops</a></li>
        <li><a href="#bonus-exercise-if-statements">Bonus exercise: if statements</a></li>
      </ul>
    </li>
    <li><a href="#going-further">Going further</a>
      <ul>
        <li><a href="#base-r-data-frame-indexing">Base R data frame indexing</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
        <main class="col-12 col-md-0 col-xl-10 py-md-3 pl-md-5 docs-content" role="main">
            

            <article class="article">

                




















  
  
    
  


<div class="article-container pt-3">
  <h1>Session 12: Vectorization and loops in R</h1>

  
  <p class="page-subtitle">Need for repeat.</p>
  

  



<div class="article-metadata">

  
  
  
  
  <div>
    

  <span >
      <a href="/authors/admin/">Jelmer Poelstra</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
    Aug 18, 2021
  </span>
  

  

  

  
  
  
  
  

  
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 438px;">
  <div style="position: relative">
    <img src="/codeclub/12_loops/featured_hu3fbc07069f722ea5436a886d56d7855f_286539_720x0_resize_q90_lanczos.jpeg" alt="" class="featured-image">
    <span class="article-header-caption">Artwork by @allison_horst</span>
  </div>
</div>



                <div class="article-container">
                    <div class="article-style">
                        <p><br> <br> <br></p>
<hr>
<h2 id="setup">Setup</h2>
<h4 id="new-to-code-club">New to Code Club?</h4>
<ul>
<li>
<p>If you didn&rsquo;t already do this, please follow the <a href="/codeclub-setup/04_ggplot2/">Code Club Computer Setup</a> instructions, which also have pointers for if you&rsquo;re new to R or RStudio.</p>
</li>
<li>
<p>If you&rsquo;re able to do so, please open RStudio a bit before Code Club starts &ndash; and in case you run into issues, please join the Zoom call early and we&rsquo;ll help you troubleshoot.</p>
</li>
</ul>
<h4 id="session-goals">Session goals</h4>
<p>Today, you will learn:</p>
<ul>
<li>That you should avoid copying your code.</li>
<li>What different strategies for <em>iteration</em> exist in R.</li>
<li>What <em>vectorization</em> is and how to make use of it.</li>
<li>How to write a <code>for</code> loop.</li>
<li>Best practices when using <code>for</code> loops.</li>
<li>When you should (not) use <code>for</code> loops.</li>
<li>Bonus: <code>if</code> statements.</li>
</ul>
<br>
<hr>
<h2 id="introduction">Introduction</h2>
<h3 id="dont-repeat-yourself">Don&rsquo;t Repeat Yourself</h3>
<p>Sometimes, you have a block of code and you need to repeat the operations in that code <em>almost</em> exactly. For instance, you may want to rerun a statistical model with different parameter values, rerun an analysis for a different batch of samples, or extract the same information for many different genes.</p>
<p>Your first instinct may be to copy-and-paste the block of code, and make the necessary slight adjustments in the pasted block. However, <em><strong>iterating</strong></em> and <em><strong>writing your own functions</strong></em> are strategies that are clearer, less error-prone, and more flexible (and these two can also be combined). When the number of repeats are high, <em>iteration</em> is needed. When the code that needs to be repeated is more than a line or two, <em>writing your own functions</em> becomes useful.</p>
<h3 id="iteration">Iteration</h3>
<p><em><strong>Loops</strong></em> are the most universal iteration tool and the one we will focus on today. However, R has &ldquo;functional programming&rdquo; iteration methods that are less verbose and that can also be quicker to execute. These are the <code>apply</code> family of functions, and a more recent <em>tidyverse</em> approach implemented in the <em>purrr</em> package: we will learn more about those in the two upcoming Code Club sessions.</p>
<p>Loops are still a very good place to start using iteration because they make the iteration explicit and are therefore more intuitive than functional alternatives. In addition, they can easily accommodate longer blocks of code without the need to <em>also</em> write your own function.</p>
<p>Today, we will talk about the most common type of loop: the <code>for</code> loops. (Other types of loops in R are <code>while</code> loops and <code>repeat</code> loops. Related to loops are <code>if</code> statements, see the <a href="#bonus-exercise-if-statements">bonus exercise</a> for some basics.)</p>
<h4 id="but-first">But first&hellip;</h4>
<p>Before we tackle loops we should take a step back and explore <em><strong>vectorization</strong></em> a bit more, which was briefly introduced by Michael in <a href="https://biodash.github.io/codeclub/09_subsetting/" target="_blank" rel="noopener">Code Club session 9</a>. Besides functional programming methods, <em>vectorization is the other reason that loops are not as widely used in R as in other programming languages</em>.</p>
<hr>
<h2 id="i-vectorization">I: Vectorization</h2>
<p>Let&rsquo;s say we have a <em>vector</em> (i.e., a collection of values) that consists of distances in miles:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>dists_miles</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>24</span>, <span class='m'>81</span>, <span class='m'>48</span>, <span class='m'>29</span>, <span class='m'>177</span>, <span class='m'>175</span>, <span class='m'>20</span>, <span class='m'>11</span>, <span class='m'>62</span>, <span class='m'>156</span><span class='o'>)</span></code></pre>
</div>
<p>Of course, we can&rsquo;t science with miles, so we&rsquo;ll have to convert these distances to kilometers by multiplying each value in the vector by 1.61. You may or may not know that this can be done <em>really easily</em> in R:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>dists_km</span> <span class='o'>&lt;-</span> <span class='nv'>dists_miles</span> <span class='o'>*</span> <span class='m'>1.61</span>
<span class='nv'>dists_km</span>
<span class='c'>#&gt;  [1]  38.64 130.41  77.28  46.69 284.97 281.75  32.20  17.71  99.82 251.16</span></code></pre>
</div>
<p>What is happening here is called a <em><strong>vectorized operation</strong></em>: <code>1.61</code> is automatically recycled as many times as needed to be multiplied with <em>each individual value</em> in the <code>dist_miles</code> vector. This is a pretty unique and very useful feature of R!</p>
<p>In many other languages, we would need a <em><strong>loop</strong></em> or a similar construct to iterate over each value in the vector and multiply by 1.61. In fact, under the hood, R <em>also</em> uses a loop to do this! So does it even make a difference? Yes &ndash; the advantages of using vectorization in R are:</p>
<ul>
<li>
<p>You don&rsquo;t have to write the loop, saving you a fair bit of typing and making the code clearer.</p>
</li>
<li>
<p>The under-the-hood-loop is being executed <em>much</em> faster than a loop that you would write. This is because it is written in <code>C</code>/<code>C++</code> code which only has to be called once (instead of at least as many times as there are iterations in our loop).</p>
</li>
</ul>
<br>
<h3 id="other-vectorization-patterns">Other vectorization patterns</h3>
<p>Above, we saw an example of multiplying a vector by a single number. We can also use vectorized operations when both objects contain multiple items. For instance, say we have a vector with corresponding values for two dates:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>dists_Mar4</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>17</span>, <span class='m'>93</span>, <span class='m'>56</span>, <span class='m'>19</span>, <span class='m'>175</span>, <span class='m'>40</span>, <span class='m'>69</span>, <span class='m'>267</span>, <span class='m'>4</span>, <span class='m'>91</span><span class='o'>)</span>
<span class='nv'>dists_Mar5</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>87</span>, <span class='m'>143</span>, <span class='m'>103</span>, <span class='m'>223</span>, <span class='m'>106</span>, <span class='m'>18</span>, <span class='m'>87</span>, <span class='m'>72</span>, <span class='m'>59</span>, <span class='m'>5</span><span class='o'>)</span></code></pre>
</div>
<p>To get the sum of these values at each position (index) of the two vectors (<code>17 + 87</code>, <code>93 + 143</code>, etc.), we can simply do the following:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>dists_Mar4</span> <span class='o'>+</span> <span class='nv'>dists_Mar5</span>
<span class='c'>#&gt;  [1] 104 236 159 242 281  58 156 339  63  96</span></code></pre>
</div>
<br>
<div class="alert alert-note">
<div>
<p>The two vectors don&rsquo;t need to be of equal length, either:<br>
in the example below, we negate <em><strong>every other</strong></em> value in a vector:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>17</span>, <span class='m'>93</span>, <span class='m'>56</span>, <span class='m'>19</span>, <span class='m'>175</span>, <span class='m'>40</span>, <span class='m'>69</span>, <span class='m'>267</span>, <span class='m'>4</span>, <span class='m'>91</span><span class='o'>)</span> <span class='o'>*</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>1</span>, <span class='o'>-</span><span class='m'>1</span><span class='o'>)</span>
<span class='c'>#&gt;  [1]   17  -93   56  -19  175  -40   69 -267    4  -91</span></code></pre>
</div>
</div>
</div>
<br>
<p>This also works for columns of a data frame, which we can extract using the <code>dataframe_name$column_name</code> notation (see <a href="https://biodash.github.io/codeclub/09_subsetting/#data-frames" target="_blank" rel="noopener">Code Club session 9&rsquo;s section on data frames</a>, and the Base R data frame indexing summary <a href="#base-r-data-frame-indexing">below</a>). Let&rsquo;s say we wanted the mean distance this time:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>dist_df</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='o'>(</span><span class='nv'>dists_Mar4</span>, <span class='nv'>dists_Mar5</span><span class='o'>)</span>

<span class='nv'>dist_df</span><span class='o'>$</span><span class='nv'>dists_mean</span> <span class='o'>=</span> <span class='o'>(</span><span class='nv'>dist_df</span><span class='o'>$</span><span class='nv'>dists_Mar4</span> <span class='o'>+</span> <span class='nv'>dist_df</span><span class='o'>$</span><span class='nv'>dists_Mar5</span><span class='o'>)</span> <span class='o'>/</span> <span class='m'>2</span>
<span class='nf'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='o'>(</span><span class='nv'>dist_df</span><span class='o'>)</span>
<span class='c'>#&gt;   dists_Mar4 dists_Mar5 dists_mean</span>
<span class='c'>#&gt; 1         17         87       52.0</span>
<span class='c'>#&gt; 2         93        143      118.0</span>
<span class='c'>#&gt; 3         56        103       79.5</span>
<span class='c'>#&gt; 4         19        223      121.0</span>
<span class='c'>#&gt; 5        175        106      140.5</span>
<span class='c'>#&gt; 6         40         18       29.0</span></code></pre>
</div>
<br>
<h3 id="vectorization-with-matrices">Vectorization with matrices</h3>
<p>Furthermore, we can also perform vectorized operations on <em>entire matrices</em>. With the following matrix:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## We use the "sample" function to get 25 random values between 1 and a 100,</span>
<span class='c'>## and put those in a 5*5 matrix:</span>
<span class='nv'>mat</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='o'>(</span><span class='nf'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='o'>(</span><span class='m'>1</span><span class='o'>:</span><span class='m'>100</span>, <span class='m'>25</span><span class='o'>)</span>, nrow <span class='o'>=</span> <span class='m'>5</span>, ncol <span class='o'>=</span> <span class='m'>5</span><span class='o'>)</span>
<span class='nv'>mat</span>
<span class='c'>#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class='c'>#&gt; [1,]    2   55    8   28   24</span>
<span class='c'>#&gt; [2,]   81   30   99   33   12</span>
<span class='c'>#&gt; [3,]   22   67   41   54    6</span>
<span class='c'>#&gt; [4,]   48   84   42   35  100</span>
<span class='c'>#&gt; [5,]   57   47   93   10   31</span></code></pre>
</div>
<p>&hellip;we could multiple all values by 10 or get the square of each value simply as follows:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>mat_more</span> <span class='o'>&lt;-</span> <span class='nv'>mat</span> <span class='o'>*</span> <span class='m'>10</span>
<span class='nv'>mat_more</span>
<span class='c'>#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class='c'>#&gt; [1,]   20  550   80  280  240</span>
<span class='c'>#&gt; [2,]  810  300  990  330  120</span>
<span class='c'>#&gt; [3,]  220  670  410  540   60</span>
<span class='c'>#&gt; [4,]  480  840  420  350 1000</span>
<span class='c'>#&gt; [5,]  570  470  930  100  310</span>

<span class='nv'>mat_squared</span> <span class='o'>&lt;-</span> <span class='nv'>mat</span> <span class='o'>*</span> <span class='nv'>mat</span>
<span class='nv'>mat_squared</span>
<span class='c'>#&gt;      [,1] [,2] [,3] [,4]  [,5]</span>
<span class='c'>#&gt; [1,]    4 3025   64  784   576</span>
<span class='c'>#&gt; [2,] 6561  900 9801 1089   144</span>
<span class='c'>#&gt; [3,]  484 4489 1681 2916    36</span>
<span class='c'>#&gt; [4,] 2304 7056 1764 1225 10000</span>
<span class='c'>#&gt; [5,] 3249 2209 8649  100   961</span></code></pre>
</div>
<br>
<h3 id="vectorization-with-indices">Vectorization with indices</h3>
<p>We can also use vectorized solutions when we want to operate only on elements that satisfy a certain condition.</p>
<p>Let&rsquo;s say we consider any distance in one of our vectors that is below 50 to be insufficient, and we want to turn those values into negatives (a little harsh maybe, but we go with it).</p>
<p>To do so, we make use of R&rsquo;s ability to index a vector with a logical vector:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## "not_far_enough" will be a vector of logicals:</span>
<span class='nv'>not_far_enough</span> <span class='o'>&lt;-</span> <span class='nv'>dists_Mar4</span> <span class='o'>&lt;</span> <span class='m'>50</span>
<span class='nv'>not_far_enough</span>
<span class='c'>#&gt;  [1]  TRUE FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE  TRUE FALSE</span>

<span class='c'>## When we index the original vector with a logical vector,</span>
<span class='c'>## we get only those values for which "not_far_enough" is TRUE:</span>
<span class='nv'>dists_Mar4</span><span class='o'>[</span><span class='nv'>not_far_enough</span><span class='o'>]</span>
<span class='c'>#&gt; [1] 17 19 40  4</span></code></pre>
</div>
<p>With the following syntax, we can replace just those low distances in our original vector:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>dists_Mar4</span><span class='o'>[</span><span class='nv'>not_far_enough</span><span class='o'>]</span> <span class='o'>&lt;-</span> <span class='nv'>dists_Mar4</span><span class='o'>[</span><span class='nv'>not_far_enough</span><span class='o'>]</span> <span class='o'>*</span> <span class='o'>-</span><span class='m'>1</span>
<span class='nv'>dists_Mar4</span>
<span class='c'>#&gt;  [1] -17  93  56 -19 175 -40  69 267  -4  91</span></code></pre>
</div>
<div class="alert alert-note">
<div>
<p>In a simple case like this, we could also use the vectorized <a href="https://rdrr.io/r/base/ifelse.html" target="_blank" rel="noopener"><code>ifelse()</code></a> function:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nf'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='o'>(</span><span class='nv'>dists_Mar5</span> <span class='o'>&lt;</span> <span class='m'>50</span>, <span class='nv'>dists_Mar5</span> <span class='o'>*</span> <span class='o'>-</span><span class='m'>1</span>, <span class='nv'>dists_Mar5</span><span class='o'>)</span>
<span class='c'>#&gt;  [1]  87 143 103 223 106 -18  87  72  59  -5</span></code></pre>
</div>
</div>
</div>
<br>
<hr>
<h2 id="ii-for-loops">II: For loops</h2>
<p>While it is important to use vectorization whenever possible, it can only be applied to a specific set of problems. A more universal solution when you need to repeat operations is the <code>for</code> loop. <code>for</code> loops iterate over a collection of values, allowing you to perform one or more actions for each value in the collection.</p>
<p>The basic syntax is as follows:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">for </span><span class="p">(</span><span class="n">variable_name</span> <span class="n">in</span> <span class="n">collection_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">#...do things for each item (variable_name) in the collection, one at a time...</span>
<span class="p">}</span>
</code></pre></div><p>On the first line, you initialize the <code>for</code> loop, telling it to assign each item in the collection to a variable (here, <code>variable_name</code>) <strong>one at a time</strong>.</p>
<p>The <em>variable name</em> is arbitrary, and the <em>collection</em> is whatever you want to loop over. However, <code>for</code>, the parentheses <code>()</code>, <code>in</code>, and the curly braces <code>{}</code> are all fixed elements of <code>for</code> loops. A simple example will help to understand the synax:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## A loop to print negated values:</span>
<span class='kr'>for</span> <span class='o'>(</span><span class='nv'>one_number</span> <span class='kr'>in</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>1</span>, <span class='m'>2</span>, <span class='m'>3</span>, <span class='m'>4</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>&#123;</span>  <span class='c'># We iterate over 1, 2, 3, 4</span>
  <span class='nf'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='o'>(</span><span class='nv'>one_number</span> <span class='o'>*</span> <span class='o'>-</span><span class='m'>1</span><span class='o'>)</span>             <span class='c'># Multiply each number by -1</span>
<span class='o'>&#125;</span>
<span class='c'>#&gt; [1] -1</span>
<span class='c'>#&gt; [1] -2</span>
<span class='c'>#&gt; [1] -3</span>
<span class='c'>#&gt; [1] -4</span></code></pre>
</div>
<p>Note that we don&rsquo;t <em>have to</em> use the variable that we are looping over: we could also use a <code>for</code> loop as a roundabout way to simply repeat something as many times as there are values in our collection:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='kr'>for</span> <span class='o'>(</span><span class='nv'>dummy</span> <span class='kr'>in</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>1</span>, <span class='m'>2</span>, <span class='m'>3</span>, <span class='m'>4</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>&#123;</span>
  <span class='nf'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='o'>(</span><span class='s'>"Yes!"</span><span class='o'>)</span>                     <span class='c'># Print "Yes!" in each of our four iterations </span>
<span class='o'>&#125;</span>
<span class='c'>#&gt; [1] "Yes!"</span>
<span class='c'>#&gt; [1] "Yes!"</span>
<span class='c'>#&gt; [1] "Yes!"</span>
<span class='c'>#&gt; [1] "Yes!"</span></code></pre>
</div>
<p>As mentioned, the <strong>variable name</strong> that we assign is arbitrary: we could use anything, as long as we reference it with the same name inside the loop:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## Example 1 with a different variable name: "positive_number"</span>
<span class='kr'>for</span> <span class='o'>(</span><span class='nv'>positive_number</span> <span class='kr'>in</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>1</span>, <span class='m'>2</span>, <span class='m'>3</span>, <span class='m'>4</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>&#123;</span>
  <span class='nf'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='o'>(</span><span class='nv'>positive_number</span> <span class='o'>*</span> <span class='o'>-</span><span class='m'>1</span><span class='o'>)</span>
<span class='o'>&#125;</span>
<span class='c'>#&gt; [1] -1</span>
<span class='c'>#&gt; [1] -2</span>
<span class='c'>#&gt; [1] -3</span>
<span class='c'>#&gt; [1] -4</span>

<span class='c'>## Example 2 with a different variable name: "i"</span>
<span class='kr'>for</span> <span class='o'>(</span><span class='nv'>i</span> <span class='kr'>in</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>1</span>, <span class='m'>2</span>, <span class='m'>3</span>, <span class='m'>4</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>&#123;</span>
  <span class='nf'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='o'>(</span><span class='nv'>i</span> <span class='o'>*</span> <span class='o'>-</span><span class='m'>1</span><span class='o'>)</span>
<span class='o'>&#125;</span>
<span class='c'>#&gt; [1] -1</span>
<span class='c'>#&gt; [1] -2</span>
<span class='c'>#&gt; [1] -3</span>
<span class='c'>#&gt; [1] -4</span></code></pre>
</div>
<p>Note that the variable as it was last assigned in the loop does <strong>persist in your environment</strong>:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>i</span>
<span class='c'>#&gt; [1] 4</span></code></pre>
</div>
<p>The <em><strong>curly braces</strong></em> are not strictly necessary for one-liners like this:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='kr'>for</span> <span class='o'>(</span><span class='nv'>i</span> <span class='kr'>in</span> <span class='m'>1</span><span class='o'>:</span><span class='m'>4</span><span class='o'>)</span> <span class='nf'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='o'>(</span><span class='nv'>i</span> <span class='o'>*</span> <span class='o'>-</span><span class='m'>1</span><span class='o'>)</span>
<span class='c'>#&gt; [1] -1</span>
<span class='c'>#&gt; [1] -2</span>
<span class='c'>#&gt; [1] -3</span>
<span class='c'>#&gt; [1] -4</span></code></pre>
</div>
<br>
<h3 id="for-loop-output"><code>for</code> loop output</h3>
<p>Note that we need the <a href="https://rdrr.io/r/base/print.html" target="_blank" rel="noopener"><code>print()</code></a> function to print anything to screen &ndash; nothing will be printed if we omit this:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='kr'>for</span> <span class='o'>(</span><span class='nv'>i</span> <span class='kr'>in</span> <span class='m'>1</span><span class='o'>:</span><span class='m'>4</span><span class='o'>)</span> <span class='o'>&#123;</span>
  <span class='nv'>i</span> <span class='o'>*</span> <span class='o'>-</span><span class='m'>1</span>
<span class='o'>&#125;</span></code></pre>
</div>
<p>Similarly, if we want the output to be saved in an object of some kind, we need to explicitly make an assignment in each iteration of the loop. <em>This is where we need to start paying attention to the design of our loop.</em> Unless computational speed is of no concern at all, you should <strong>avoid growing an object in each iteration of the loop</strong>.</p>
<p>For example, you might be inclined to do the following if you wanted to compute the median of each column in a data frame:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## We initialize a vector in which we collect the column medians:</span>
<span class='nv'>column_medians</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='o'>(</span><span class='o'>)</span>

<span class='kr'>for</span> <span class='o'>(</span><span class='nv'>column_number</span> <span class='kr'>in</span> <span class='m'>1</span><span class='o'>:</span><span class='nf'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='o'>(</span><span class='nv'>dist_df</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>&#123;</span>
  
  <span class='c'>## We extract one column using "dataframe_name[[column_number]]":</span>
  <span class='nv'>column_median</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='o'>(</span><span class='nv'>dist_df</span><span class='o'>[[</span><span class='nv'>column_number</span><span class='o'>]</span><span class='o'>]</span><span class='o'>)</span>
  
  <span class='c'>## We add the single-column median to our vector of medians:</span>
  <span class='nv'>column_medians</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='nv'>column_medians</span>, <span class='nv'>column_median</span><span class='o'>)</span>
<span class='o'>&#125;</span>

<span class='nv'>column_medians</span>
<span class='c'>#&gt; [1] 62.50 87.00 78.75</span></code></pre>
</div>
<p>Similarly, you may be tempted to add a column (with <a href="https://rdrr.io/r/base/cbind.html" target="_blank" rel="noopener"><code>cbind()</code></a>) or a row (with <a href="https://rdrr.io/r/base/cbind.html" target="_blank" rel="noopener"><code>rbind()</code></a>) to a data frame in each iteration of the loop. However, the problem with these approaches is that <strong>R has to create an entirely new object in each iteration of the loop</strong>, because the object&rsquo;s memory requirements keep increasing.</p>
<p>Instead, you&rsquo;ll want to give the final vector (here, <code>column_medians</code>) the appropriate size before you start the loop:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>column_medians</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='o'>(</span>length <span class='o'>=</span> <span class='nf'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='o'>(</span><span class='nv'>dist_df</span><span class='o'>)</span><span class='o'>)</span>

<span class='kr'>for</span> <span class='o'>(</span><span class='nv'>column_number</span> <span class='kr'>in</span> <span class='m'>1</span><span class='o'>:</span><span class='nf'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='o'>(</span><span class='nv'>dist_df</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>&#123;</span>
  <span class='nv'>column_median</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='o'>(</span><span class='nv'>dist_df</span><span class='o'>[[</span><span class='nv'>column_number</span><span class='o'>]</span><span class='o'>]</span><span class='o'>)</span>
  <span class='nv'>column_medians</span><span class='o'>[</span><span class='nv'>column_number</span><span class='o'>]</span> <span class='o'>&lt;-</span> <span class='nv'>column_median</span>
<span class='o'>&#125;</span></code></pre>
</div>
<p>Note that for very small problems, such as the example above, there will not be a noticeable difference in computation time between pre-assigning a properly sized object versus growing an object inside the loop. However, it is still good to get into the habit of pre-assigning an object of the right size.</p>
<br>
<h3 id="summary-guidelines-when-speed-is-an-issue">Summary guidelines (when speed is an issue)</h3>
<ul>
<li>Don&rsquo;t use a loop when you can instead use vectorized operations.</li>
<li>Don&rsquo;t grow objects inside the loop. Instead, pre-assign an object large enough to contain all output of the loop and fill it in inside the loop.</li>
<li>When you write a loop, avoid doing things <em>inside</em> the loop that don&rsquo;t need to be repeated.</li>
</ul>
<p>Learning about how to create your own functions and/or to use functional programming techniques like <em>purrr</em> and the <code>apply</code> family of functions (upcoming Code Club sessions!) will likely reduce your reliance on loops. For instance, as we&rsquo;ll see next week, computing the median of each column in a data frame can be done <em>much</em> more succinctly with <a href="https://rdrr.io/r/base/apply.html" target="_blank" rel="noopener"><code>apply()</code></a>.</p>
<p><strong>Even for more experienced users, loops remain a more viable option when longer blocks of code need to be repeated: we will practice with that in the exercises.</strong></p>
<br>
<hr>
<h2 id="breakout-rooms">Breakout rooms!</h2>
<p>For the exercises, you can download an R Markdown file with some code to get set up (I recommend coding in that document to get a nice overview of the maps that you will make):</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nf'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='o'>(</span><span class='s'>'S12'</span><span class='o'>)</span>
<span class='nv'>todays_rmd</span> <span class='o'>&lt;-</span> <span class='s'>'https://raw.githubusercontent.com/biodash/biodash.github.io/master/content/codeclub/12_loops/exercises.Rmd'</span>
<span class='nf'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='o'>(</span>url <span class='o'>=</span> <span class='nv'>todays_rmd</span>, destfile <span class='o'>=</span> <span class='s'>'S12/exercises.Rmd'</span><span class='o'>)</span></code></pre>
</div>
<p>The following code is already in your R Markdown file, which will download and read the bird dataset and the necessary packages:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## Download the file with bird data:</span>
<span class='nv'>birds_url</span> <span class='o'>&lt;-</span> <span class='s'>'https://raw.githubusercontent.com/biodash/biodash.github.io/master/assets/data/birds/backyard-birds_sample_error.tsv'</span>
<span class='nv'>birds_file</span> <span class='o'>&lt;-</span> <span class='s'>'backyard-birds_sample_error.tsv'</span>
<span class='nf'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='o'>(</span>url <span class='o'>=</span> <span class='nv'>birds_url</span>, destfile <span class='o'>=</span> <span class='nv'>birds_file</span><span class='o'>)</span></code></pre>
</div>
<div class="highlight">
</div>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## Load the tidyverse:</span>
<span class='kr'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='o'>(</span><span class='nv'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='o'>)</span>

<span class='c'>## Read the file with bird data:</span>
<span class='nv'>birds</span> <span class='o'>&lt;-</span> <span class='nf'>read_tsv</span><span class='o'>(</span><span class='nv'>birds_file</span><span class='o'>)</span>

<span class='c'>## Load the maps package and get the state map:</span>
<span class='c'># install.packages('maps')   # first install if necessary</span>
<span class='kr'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='o'>(</span><span class='nv'>maps</span><span class='o'>)</span>
<span class='nv'>states</span> <span class='o'>&lt;-</span> <span class='nf'>map_data</span><span class='o'>(</span><span class='s'>"state"</span><span class='o'>)</span></code></pre>
</div>
<p>Last week, we learned about making maps. If you attended one of the first few Code Club sessions, you&rsquo;ll recall our <strong>Great Backyard Birdcount data set</strong>. Here, we&rsquo;ll use a country-wide random subset of this data (the full file is over 4 GB) to see where Carolina Chickadees were seen:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## With this line, we select only the rows where the column "species_en"</span>
<span class='c'>## (English species name) equals "Carolina Chickadee",</span>
<span class='c'>## i.e. we are getting just the records for the Carolina Chickadee:</span>
<span class='nv'>caro_chickadee</span> <span class='o'>&lt;-</span> <span class='nv'>birds</span><span class='o'>[</span><span class='nv'>birds</span><span class='o'>$</span><span class='nv'>species_en</span> <span class='o'>==</span> <span class='s'>'Carolina Chickadee'</span>, <span class='o'>]</span>

<span class='c'>## Or in tidyverse-speak:</span>
<span class='c'># caro_chickadee &lt;- birds %&gt;% filter(species_en == 'Carolina Chickadee')</span>

<span class='c'># Next, we create a map much like we did last week:</span>
<span class='nf'>ggplot</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>states</span>,                               <span class='c'># Use "states" for underlying map</span>
       mapping <span class='o'>=</span> <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='nv'>group</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>geom_polygon</span><span class='o'>(</span>color <span class='o'>=</span> <span class='s'>"black"</span>, fill <span class='o'>=</span> <span class='s'>"white"</span><span class='o'>)</span> <span class='o'>+</span>   <span class='c'># Black state outlines, white fill</span>
  <span class='nf'>geom_point</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>caro_chickadee</span>,                 <span class='c'># Plot points from bird data set</span>
             <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='kc'>NULL</span><span class='o'>)</span>,
             color <span class='o'>=</span> <span class='s'>"green4"</span>, alpha <span class='o'>=</span> <span class='m'>0.5</span><span class='o'>)</span> <span class='o'>+</span>       <span class='c'># Green points, somewhat transparent</span>
  <span class='nf'>coord_fixed</span><span class='o'>(</span><span class='m'>1.3</span><span class='o'>)</span> <span class='o'>+</span>                                <span class='c'># Fix projection</span>
  <span class='nf'>labs</span><span class='o'>(</span>title <span class='o'>=</span> <span class='s'>'Carolina Chickadee'</span><span class='o'>)</span>
</code></pre>
<p><img src="figs/unnamed-chunk-24-1.png" width="700px" style="display: block; margin: auto;" /></p>
</div>
<p>Uh-oh! Something appears to have gone wrong. In the first exercise, you&rsquo;ll use vectorization to fix the coordinates in the bird data set.</p>
<p>In the second exercise, you&rsquo;ll use a loop to quickly produce similar plots for several other species.</p>
<div class="puzzle">
<div>
<h3 id="exercise-1-vectorization">Exercise 1: Vectorization</h3>
<p>Try to fix the coordinates using vectorized operations, and recreate the map to see if it worked.</p>
<ul>
<li>Start with the <strong>latitude</strong>, which is wrong for all points.</li>
</ul>
<details>
<summary>
Hints (click here)
</summary>
<p>
<ul>
<li>
<p>You&rsquo;ll need to modify the <code>caro_chickadee</code> data frame, while you can keep the plotting code exactly the same.</p>
</li>
<li>
<p>Simply prepending the latitude column with a minus sign (<a href="https://rdrr.io/r/base/Arithmetic.html" target="_blank" rel="noopener"><code>-</code></a>) will negate the values.</p>
</li>
<li>
<p>Equivalent base R ways to refer to the column with latitudes are <code>caro_chickadee$lat</code> and <code>caro_chickadee[['lat']]</code>.</p>
</li>
</ul>
</p>
</details>
<br>
<details>
<summary>
Solution (click here)
</summary>
<br>
<p>First we fix the latitude, which was simply negated:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>caro_chickadee</span><span class='o'>$</span><span class='nv'>lat</span> <span class='o'>&lt;-</span> <span class='o'>-</span><span class='nv'>caro_chickadee</span><span class='o'>$</span><span class='nv'>lat</span>

<span class='c'>## Or equivalently:</span>
<span class='c'># caro_chickadee[['lat']] &lt;- -caro_chickadee[['lat']]</span>

<span class='c'>## Or a tidyverse way of doing this:</span>
<span class='c'># caro_chickadee &lt;- caro_chickadee %&gt;% mutate(lat = -lat)</span></code></pre>
</div>
<p>Create the first map with the same code as the example:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nf'>ggplot</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>states</span>,
       mapping <span class='o'>=</span> <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='nv'>group</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>geom_polygon</span><span class='o'>(</span>color <span class='o'>=</span> <span class='s'>"black"</span>, fill <span class='o'>=</span> <span class='s'>"white"</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>geom_point</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>caro_chickadee</span>,
             <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='kc'>NULL</span><span class='o'>)</span>,
             color <span class='o'>=</span> <span class='s'>"green4"</span>, alpha <span class='o'>=</span> <span class='m'>0.5</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>coord_fixed</span><span class='o'>(</span><span class='m'>1.3</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>labs</span><span class='o'>(</span>title <span class='o'>=</span> <span class='s'>'Carolina Chickadee'</span><span class='o'>)</span>
</code></pre>
<p><img src="figs/unnamed-chunk-26-1.png" width="700px" style="display: block; margin: auto;" /></p>
</div>
</p>
</details>
<br>
<ul>
<li>Once you have fixed the latitude, you should notice that <em>for one state</em>, there is a problem with the <strong>longitude</strong> (the offset is 10 decimal degrees).</li>
</ul>
<details>
<summary>
Hints (click here)
</summary>
<p>
<ul>
<li>
<p>The displaced state is North Carolina.</p>
</li>
<li>
<p>The state of each sighting is in the <code>stateProvince</code> column, and North Carolina&rsquo;s name is simply &ldquo;North Carolina&rdquo; in that column.</p>
</li>
<li>
<p>It may help to first create a logical vector indicating whether for each row in the <code>caro_chickadee</code> data frame, <code>stateProvincefor</code> equals &ldquo;North Carolina&rdquo;.</p>
</li>
<li>
<p>Your final map will look nicer if you get rid of the plotting canvas by adding<br>
<code>+ theme_void()</code> to the code for the plot.</p>
</li>
</ul>
</p>
</details>
<br>
<details>
<summary>
Solution (click here)
</summary>
<br>
<p>It turns out that North Carolina&rsquo;s chickadees are above the Atlantic. Let&rsquo;s perform a rescue operation by fixing the longitudes, which are offset by 10 degrees, <strong>just for North Carolina</strong>:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## Get a vector of logicals, indicating which rows are from North Carolina:</span>
<span class='nv'>NC_rows</span> <span class='o'>&lt;-</span> <span class='nv'>caro_chickadee</span><span class='o'>$</span><span class='nv'>stateProvince</span> <span class='o'>==</span> <span class='s'>"North Carolina"</span>

<span class='c'>## Only for North Carolina rows, change the longitude:</span>
<span class='nv'>caro_chickadee</span><span class='o'>$</span><span class='nv'>long</span><span class='o'>[</span><span class='nv'>NC_rows</span><span class='o'>]</span> <span class='o'>&lt;-</span> <span class='nv'>caro_chickadee</span><span class='o'>$</span><span class='nv'>long</span><span class='o'>[</span><span class='nv'>NC_rows</span><span class='o'>]</span> <span class='o'>-</span> <span class='m'>10</span>

<span class='c'>## Or with ifelse in one line:</span>
<span class='c'># caro_chickadee$long &lt;- ifelse(caro_chickadee$stateProvince == "North Carolina",</span>
<span class='c'>#                               caro_chickadee$long - 10,</span>
<span class='c'>#                               caro_chickadee$long)</span>

<span class='c'>## Or with mutate and ifelse:</span>
<span class='c'># caro_chickadee %&gt;%</span>
<span class='c'>#   mutate(long = ifelse(stateProvince == "North Carolina", long - 10, long))</span></code></pre>
</div>
<p>And we create the final map:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nf'>ggplot</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>states</span>,
       mapping <span class='o'>=</span> <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='nv'>group</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>geom_polygon</span><span class='o'>(</span>color <span class='o'>=</span> <span class='s'>"black"</span>, fill <span class='o'>=</span> <span class='s'>"white"</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>geom_point</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>caro_chickadee</span>,
             <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='kc'>NULL</span><span class='o'>)</span>,
             color <span class='o'>=</span> <span class='s'>"green4"</span>, alpha <span class='o'>=</span> <span class='m'>0.5</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>coord_fixed</span><span class='o'>(</span><span class='m'>1.3</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>labs</span><span class='o'>(</span>title <span class='o'>=</span> <span class='s'>'Carolina Chickadee'</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>theme_void</span><span class='o'>(</span><span class='o'>)</span>
</code></pre>
<p><img src="figs/unnamed-chunk-28-1.png" width="700px" style="display: block; margin: auto;" /></p>
</div>
<p>Nice!</p>
<br>
</details>
</div>
</div>
<div class="puzzle">
<div>
<h3 id="exercise-2-for-loops">Exercise 2: for loops</h3>
<p>Find the 10 most commonly observed bird species in the data set, and save their English names (found in the <code>species_en</code> column) in a vector.</p>
<p>Feel free to check out the solution if you&rsquo;re not sure how, because the focus here is on the next step: trying to create a loop.</p>
<details>
<summary>
Solution (click here)
</summary>
<p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>top10</span> <span class='o'>&lt;-</span> <span class='nv'>birds</span> <span class='o'>%&gt;%</span>
  <span class='nf'>count</span><span class='o'>(</span><span class='nv'>species_en</span>, sort <span class='o'>=</span> <span class='kc'>TRUE</span><span class='o'>)</span> <span class='o'>%&gt;%</span>  <span class='c'># Produces a sorted count table for "species_en"</span>
  <span class='nf'>pull</span><span class='o'>(</span><span class='nv'>species_en</span><span class='o'>)</span> <span class='o'>%&gt;%</span>                <span class='c'># Extracts the "species_en" column</span>
  <span class='nf'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='o'>(</span>n <span class='o'>=</span> <span class='m'>10</span><span class='o'>)</span>                        <span class='c'># Take the top 10</span></code></pre>
</div>
</p>
</details>
<br>
<p>Next, loop over the top-10 species to produce a plot for each one of them.<br>
Start with the code for the Carolina Chickadee, including the subsetting operation, and modify that.</p>
<details>
<summary>
Hints (click here)
</summary>
<p>
<ul>
<li>
<p>In the subsetting operation where you select data for the focal species, replace &ldquo;Carolina Chickadee&rdquo; with whatever you name the variable (indicating an individual species) that you loop over.</p>
<p>Because this is a variable name, and not a string like &ldquo;Carolina Chickadee&rdquo;, don&rsquo;t forget to omit the quotes.</p>
</li>
<li>
<p>You&rsquo;ll also need to change the title with the looping variable.</p>
</li>
</ul>
</p>
</details>
<br>
<details>
<summary>
Solution (click here)
</summary>
<br>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='kr'>for</span> <span class='o'>(</span><span class='nv'>one_species</span> <span class='kr'>in</span> <span class='nv'>top10</span><span class='o'>)</span> <span class='o'>&#123;</span>

<span class='c'>## Select just the data for one species:</span>
<span class='nv'>one_bird_data</span> <span class='o'>&lt;-</span> <span class='nv'>birds</span><span class='o'>[</span><span class='nv'>birds</span><span class='o'>$</span><span class='nv'>species_en</span> <span class='o'>==</span> <span class='nv'>one_species</span>, <span class='o'>]</span>
<span class='c'>## Or in tidyverse-speak:</span>
<span class='c'># one_bird_data &lt;- birds %&gt;% filter(species_en == one_species)</span>

<span class='nv'>p</span> <span class='o'>&lt;-</span> <span class='nf'>ggplot</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>states</span>,
            mapping <span class='o'>=</span> <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='nv'>group</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>geom_polygon</span><span class='o'>(</span>color <span class='o'>=</span> <span class='s'>"black"</span>, fill <span class='o'>=</span> <span class='s'>"white"</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>geom_point</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>one_bird_data</span>,
             <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='kc'>NULL</span><span class='o'>)</span>,
             color <span class='o'>=</span> <span class='s'>"green4"</span>, alpha <span class='o'>=</span> <span class='m'>0.5</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>coord_fixed</span><span class='o'>(</span><span class='m'>1.3</span><span class='o'>)</span> <span class='o'>+</span>
  <span class='nf'>labs</span><span class='o'>(</span>title <span class='o'>=</span> <span class='nv'>one_species</span><span class='o'>)</span> <span class='o'>+</span>  <span class='c'># Make sure to change this to the looping variable</span>
  <span class='nf'>theme_void</span><span class='o'>(</span><span class='o'>)</span>
<span class='nf'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='o'>(</span><span class='nv'>p</span><span class='o'>)</span>
<span class='o'>&#125;</span>
</code></pre>
<p><img src="figs/unnamed-chunk-30-1.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-2.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-3.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-4.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-5.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-6.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-7.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-8.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-9.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-30-10.png" width="700px" style="display: block; margin: auto;" /></p>
</div>
<br>
</details>
</div>
</div>
<h3 id="bonus-exercise-if-statements">Bonus exercise: if statements</h3>
<p><code>if</code> statements are similar in syntax to <code>for</code> loops, and are also considered a &ldquo;control flow&rdquo; structure. But their purpose is different from loops: instead of iterating, <strong><code>if</code> statements do something once and they <em>only</em> do it when a condition is fulfilled.</strong></p>
<p>For instance, we may want to check in a script whether a certain directory (folder) exists on our computer, and if it doesn&rsquo;t, then we create the directory:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='kr'>if</span> <span class='o'>(</span><span class='nf'><a href='https://rdrr.io/r/base/files2.html'>dir.exists</a></span><span class='o'>(</span><span class='s'>'path/to/my/dir'</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>&#123;</span>
  <span class='kr'><a href='https://rdrr.io/r/base/warning.html'>warning</a></span><span class='o'>(</span><span class='s'>"Oh my, the output directory doesn't exist yet!"</span><span class='o'>)</span>
  <span class='nf'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='o'>(</span><span class='s'>'path/to/my/dir'</span><span class='o'>)</span>
<span class='o'>&#125;</span></code></pre>
</div>
<p>Inside the parentheses <code>()</code> after <code>if</code> should be a statement that evaluates to either <code>TRUE</code> or <code>FALSE</code> (<a href="https://rdrr.io/r/base/files2.html" target="_blank" rel="noopener"><code>dir.exists()</code></a> will be <code>TRUE</code> if the directory exists, and <code>FALSE</code> if it does not). If it is <code>TRUE</code>, whatever is inside the curly braces <code>{}</code> will be executed, and if it is <code>FALSE</code>, what is inside the curly braces will be ignored.</p>
<p><code>if</code> statements are commonly combined with <code>for</code> loops: we may want to only execute the functions in our loop for items in our collection that fulfill a certain condition:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='kr'>for</span> <span class='o'>(</span><span class='nv'>one_number</span> <span class='kr'>in</span> <span class='m'>1</span><span class='o'>:</span><span class='m'>10</span><span class='o'>)</span> <span class='o'>&#123;</span>
  <span class='kr'>if</span><span class='o'>(</span><span class='nv'>one_number</span> <span class='o'>&gt;</span> <span class='m'>7</span><span class='o'>)</span> <span class='o'>&#123;</span>
    <span class='nf'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='o'>(</span><span class='nv'>one_number</span><span class='o'>)</span>
  <span class='o'>&#125;</span>
<span class='o'>&#125;</span>
<span class='c'>#&gt; [1] 8</span>
<span class='c'>#&gt; [1] 9</span>
<span class='c'>#&gt; [1] 10</span></code></pre>
</div>
<p>In the example above, <code>one number &gt; 7</code> will only be <code>TRUE</code> for numbers larger than 7. This example is quite contrived, as it would have been easier (and faster!) to remove these items from the vector before the loop, but it hopefully gets the point across of how an <code>if</code> statement works.</p>
<div class="puzzle">
<div>
<p>Many of the maps we produced in the previous exercise looked quite similar, with most species very widespread and a few restricted to the east of the US. Maybe if we select species that haven&rsquo;t been seen in Ohio, we can find some other distributional patterns.</p>
<p>First, select the the top 50 most observed bird species, just like you did in exercise 2.</p>
<p>Then, use an <code>if</code> statement to create plots only for those top-50 birds that have <em>not</em> been seen in Ohio.</p>
<details>
<summary>
Solution (click here)
</summary>
<br>
<ul>
<li>Select the top-50 birds:</li>
</ul>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>all_species</span> <span class='o'>&lt;-</span> <span class='nv'>birds</span> <span class='o'>%&gt;%</span>
  <span class='nf'>count</span><span class='o'>(</span><span class='nv'>species_en</span>, sort <span class='o'>=</span> <span class='kc'>TRUE</span><span class='o'>)</span> <span class='o'>%&gt;%</span>
  <span class='nf'>pull</span><span class='o'>(</span><span class='nv'>species_en</span><span class='o'>)</span> <span class='o'>%&gt;%</span>
  <span class='nf'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='o'>(</span>n <span class='o'>=</span> <span class='m'>50</span><span class='o'>)</span></code></pre>
</div>
<ul>
<li>Loop over the species:</li>
</ul>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='kr'>for</span> <span class='o'>(</span><span class='nv'>one_species</span> <span class='kr'>in</span> <span class='nv'>all_species</span><span class='o'>)</span> <span class='o'>&#123;</span>

  <span class='c'>## Select the focal species:</span>
  <span class='nv'>one_bird</span> <span class='o'>&lt;-</span> <span class='nv'>birds</span><span class='o'>[</span><span class='nv'>birds</span><span class='o'>$</span><span class='nv'>species_en</span> <span class='o'>==</span> <span class='nv'>one_species</span>, <span class='o'>]</span>
  
  <span class='c'>## Create a data frame with only records from Ohio:</span>
  <span class='nv'>one_bird_ohio</span> <span class='o'>&lt;-</span> <span class='nv'>one_bird</span><span class='o'>[</span><span class='nv'>one_bird</span><span class='o'>$</span><span class='nv'>stateProvince</span> <span class='o'>==</span> <span class='s'>'Ohio'</span>, <span class='o'>]</span>

  <span class='c'>## Test whether the data frame with only records from Ohio has any rows.</span>
  <span class='c'>## If it does not, we create the map for the species in question: </span>
  <span class='kr'>if</span><span class='o'>(</span><span class='nf'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='o'>(</span><span class='nv'>one_bird_ohio</span><span class='o'>)</span> <span class='o'>==</span> <span class='m'>0</span><span class='o'>)</span> <span class='o'>&#123;</span>
  
    <span class='nv'>p</span> <span class='o'>&lt;-</span> <span class='nf'>ggplot</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>states</span>,
           mapping <span class='o'>=</span> <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='nv'>group</span><span class='o'>)</span><span class='o'>)</span> <span class='o'>+</span>
      <span class='nf'>geom_polygon</span><span class='o'>(</span>color <span class='o'>=</span> <span class='s'>"black"</span>, fill <span class='o'>=</span> <span class='s'>"white"</span><span class='o'>)</span> <span class='o'>+</span>
      <span class='nf'>geom_point</span><span class='o'>(</span>data <span class='o'>=</span> <span class='nv'>one_bird</span>,
                 <span class='nf'>aes</span><span class='o'>(</span>x <span class='o'>=</span> <span class='nv'>long</span>, y <span class='o'>=</span> <span class='nv'>lat</span>, group <span class='o'>=</span> <span class='kc'>NULL</span><span class='o'>)</span>,
                 color <span class='o'>=</span> <span class='s'>"green4"</span>, alpha <span class='o'>=</span> <span class='m'>0.5</span><span class='o'>)</span> <span class='o'>+</span>
      <span class='nf'>coord_fixed</span><span class='o'>(</span><span class='m'>1.3</span><span class='o'>)</span> <span class='o'>+</span>
      <span class='nf'>labs</span><span class='o'>(</span>title <span class='o'>=</span> <span class='nv'>one_species</span><span class='o'>)</span> <span class='o'>+</span>
      <span class='nf'>theme_void</span><span class='o'>(</span><span class='o'>)</span>
    <span class='nf'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='o'>(</span><span class='nv'>p</span><span class='o'>)</span>
    <span class='o'>&#125;</span>
<span class='o'>&#125;</span>
</code></pre>
<p><img src="figs/unnamed-chunk-34-1.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-34-2.png" width="700px" style="display: block; margin: auto;" /><img src="figs/unnamed-chunk-34-3.png" width="700px" style="display: block; margin: auto;" /></p>
</div>
<br>
</details>
</div>
</div>
<br>
<hr>
<h2 id="going-further">Going further</h2>
<div class="alert alert-note">
<div>
<h3 id="base-r-data-frame-indexing">Base R data frame indexing</h3>
<p>Extract a column <em>as a vector</em>:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## By name:</span>
<span class='nv'>birds</span><span class='o'>$</span><span class='nv'>lat</span>
<span class='nv'>birds</span><span class='o'>[[</span><span class='s'>'lat'</span><span class='o'>]</span><span class='o'>]</span>   <span class='c'># Equivalent, $ notation is shorthand</span>

<span class='c'>## By index (column number):</span>
<span class='nv'>birds</span><span class='o'>[[</span><span class='m'>8</span><span class='o'>]</span><span class='o'>]</span></code></pre>
</div>
<p>Extract one or more columns <em>as a data frame</em> using <code>[row, column]</code> notation,<br>
with a leading comma (<code>[, column]</code>) meaning all rows:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='c'>## By name:</span>
<span class='nv'>birds</span><span class='o'>[</span>, <span class='s'>'lat'</span><span class='o'>]</span>   <span class='c'># dataframe['row_name', 'column_name']</span>
<span class='nv'>birds</span><span class='o'>[</span>, <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='s'>'lat'</span>, <span class='s'>'long'</span><span class='o'>)</span><span class='o'>]</span>

<span class='c'>## By index (column numbers):</span>
<span class='nv'>birds</span><span class='o'>[</span>, <span class='m'>8</span><span class='o'>]</span>       <span class='c'># dataframe[row_number, column_number]</span>
<span class='nv'>birds</span><span class='o'>[</span>, <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='m'>8</span>, <span class='m'>9</span><span class='o'>)</span><span class='o'>]</span>
</code></pre>
</div>
<p>Subset rows by a condition, with a trailing comma (<code>[row, ]</code>) meaning all columns:</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>birds</span><span class='o'>[</span><span class='nv'>birds</span><span class='o'>$</span><span class='nv'>lat</span> <span class='o'>&gt;</span> <span class='m'>25</span>, <span class='o'>]</span>
<span class='nv'>birds</span><span class='o'>[</span><span class='nv'>birds</span><span class='o'>$</span><span class='nv'>species_en</span> <span class='o'>==</span> <span class='s'>'Carolina Chickadee'</span>, <span class='o'>]</span></code></pre>
</div>
</div>
</div>
<br>
<div class="alert alert-note">
<div>
<h4 id="seq_along"><code>seq_along()</code></h4>
<p>To loop over column indices, we have used <code>1:ncol()</code> above, and to loop over vector indices, you could similarly use <code>1:length()</code>.</p>
<p>However, an alternative is <a href="https://rdrr.io/r/base/seq.html" target="_blank" rel="noopener"><code>seq_along()</code></a>, which will create an index for you.</p>
<div class="highlight">
<pre class='chroma'><code class='language-r' data-lang='r'><span class='nv'>birds</span> <span class='o'>&lt;-</span> <span class='nf'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='o'>(</span><span class='s'>'titmouse'</span>, <span class='s'>'chickadee'</span>, <span class='s'>'cardinal'</span><span class='o'>)</span>
<span class='nf'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='o'>(</span><span class='nv'>birds</span><span class='o'>)</span>
<span class='c'>#&gt; [1] 1 2 3</span></code></pre>
</div>
<p>The advantage of <a href="https://rdrr.io/r/base/seq.html" target="_blank" rel="noopener"><code>seq_along()</code></a> is thtat it will behave better when your vector accidentally has length 0 (because <code>1:length()</code> will have <code>1</code> and <code>0</code> when the length is 0, and you&rsquo;ll get odd-seeming errors).</p>
</div>
</div>
<h4 id="further-reading">Further reading</h4>
<ul>
<li><a href="http://www.noamross.net/archives/2014-04-16-vectorization-in-r-why/" target="_blank" rel="noopener">Vectorization in R: Why?</a> (Noam Ross, 2014)</li>
<li>The <a href="https://r4ds.had.co.nz/iteration.html" target="_blank" rel="noopener">Iteration chapter</a> in Hadley Wickham&rsquo;s R for Data Science (2017)</li>
</ul>

                    </div>

                    <br>

                    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/codeclub/">codeclub</a>
  
  <a class="badge badge-light" href="/tags/markdown/">markdown</a>
  
  <a class="badge badge-light" href="/tags/rmarkdown/">rmarkdown</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://biodash.github.io/codeclub/12_loops/&amp;text=Session%2012:%20Vectorization%20and%20loops%20in%20R" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://biodash.github.io/codeclub/12_loops/&amp;t=Session%2012:%20Vectorization%20and%20loops%20in%20R" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Session%2012:%20Vectorization%20and%20loops%20in%20R&amp;body=https://biodash.github.io/codeclub/12_loops/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://biodash.github.io/codeclub/12_loops/&amp;title=Session%2012:%20Vectorization%20and%20loops%20in%20R" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Session%2012:%20Vectorization%20and%20loops%20in%20R%20https://biodash.github.io/codeclub/12_loops/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://biodash.github.io/codeclub/12_loops/&amp;title=Session%2012:%20Vectorization%20and%20loops%20in%20R" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  
    



  
  
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="/authors/admin/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu6d2513500ad4d038e15c8975d9d8565d_488180_270x270_fill_q90_lanczos_center.jpg" alt="Jelmer Poelstra"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="/authors/admin/">Jelmer Poelstra</a></h5>
      <h6 class="card-subtitle">Bioinformatician at MCIC</h6>
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:poelstra.1@osu.edu" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=h_a6S0cAAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/jelmerp" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  
















                    <br>

                    <hr class="separator">

                    <div class="clearfix">
                        
                        
                        <span class="previous-link">
                            <a href="https://biodash.github.io/codeclub/11_ggplot-maps/">← Session 11: Spatial data visualization with ggplot2</a>
                        </span>
                        
                        
                        
                        
                        <span class="next-link">
                            <a href="https://biodash.github.io/codeclub/13_apply/">Session 13: Applying The Apply Functions →</a>
                        </span>
                        
                        
                    </div>

                    <hr class="separator">

                </div>

            </article>

            
        </main>
    </div>
</div>

  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">
    
    <p class="powered-by">
      <a href="/license/">LICENSE: CC-BY-SA <br> <i class="fab fa-creative-commons fa-2x"></i><i class="fab fa-creative-commons-by fa-2x"></i><i class="fab fa-creative-commons-sa fa-2x"></i> </a><br>
    </p>
    
</footer>
    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
      

    

    
    
    
      <script async defer src="https://maps.googleapis.com/maps/api/js?key="></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gmaps.js/0.4.25/gmaps.min.js" integrity="sha256-7vjlAeb8OaTrCXZkCNun9djzuB2owUsaO72kXaFDBJs=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.6aed84840afc03ab4d5750157f69c120.js"></script>

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
      
    
    <script src="/en/js/wowchemy.min.2f16af175a3ec51b41b36bb4934b1cf7.js"></script>

    






</body>
</html>
